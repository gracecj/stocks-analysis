name: Update Quarto Project

on: 
  schedule:
    - cron: '20 7 * * *'
    - cron: '0 14 * * *'
    - cron: '0 15 * * *'
    - cron: '0 16 * * *'
    - cron: '0 17 * * *'
    - cron: '0 18 * * *'
    - cron: '0 19 * * *'
    - cron: '0 20 * * *'
    - cron: '0 21 * * *'

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Quarto
        uses: quarto-dev/quarto-actions/setup@v2

      - name: Setup Python
        uses: actions/setup-python@v3
      - run: pip install jupyter pytz yfinance

      - name: Clone Project
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git clone "https://github.com/gracecj/stocks-analysis.git"

      - name: Re-render site
        run: |
          cd stocks-analysis
          cd src
          quarto render

      - name: Push new version
        run: |
          cd stocks-analysis
          git remote set-url origin https://x-access-token:${{ secrets.PAT_TOKEN }}@github.com/gracecj/stocks-analysis.git
          git add .
          git commit -m "Stocks Update"
          git push
